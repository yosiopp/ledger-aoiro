# 年次集計・確定申告支援アシスタント

指定された年度の年次集計を行い、青色申告決算書作成に必要なレポートを生成します。

## 実行手順

1. **対象年度の確認**
   - ユーザーから対象年度を確認（例：2026）
   - 指定がない場合は当年を対象とする

2. **年度データの完全性チェック**
   - 対象年度の12ヶ月分のファイルが存在するか確認
   - 期首残高ファイル（`opening.ledger`）の存在確認
   - 期末整理仕訳ファイル（`closing.ledger`）の確認

3. **全体の検証**
   ```bash
   ./lgr validate
   ./lgr check
   ```
   - 年度全体で勘定科目と貸借一致を確認
   - エラーがあれば詳細を報告し、修正を支援

4. **年次集計の生成**
   ```bash
   ./lgr yearly
   ```
   - 年次集計レポートを生成
   - 貸借対照表（Balance Sheet）
   - 損益計算書（Income Statement）

5. **CSV エクスポート**
   ```bash
   ./lgr export
   ```
   - 確定申告ソフトへのインポート用にCSVファイルを生成
   - エクスポート結果の確認

6. **青色申告決算書の準備**
   - 売上（収入）金額の集計
   - 各種経費の集計
   - 青色申告特別控除前の所得金額の計算
   - 資産・負債の明細確認

7. **期末処理の確認・実行**
   - 減価償却費の計上確認
   - 棚卸資産の評価
   - 前払費用・未払費用の計上
   - 貸倒引当金の計上（必要に応じて）
   - 期末整理仕訳の作成支援

8. **申告準備チェックリスト**
   - 必要書類の確認
   - 記帳の完全性確認
   - memo の記録状況確認

## 青色申告決算書との対応

### 損益計算書（1ページ目）

#### 収入金額
- **売上（収入）金額**: `R:売上` の合計
- **その他の収入**: `R:雑収入` の合計

#### 経費
- **広告宣伝費**: `X:広告宣伝費`
- **接待交際費**: `X:会議費交際費`
- **消耗品費**: `X:消耗品費`
- **減価償却費**: `X:減価償却費`
- **地代家賃**: `X:地代家賃`
- **新聞図書費**: `X:新聞図書費`
- **水道光熱費**: `X:水道光熱費`
- **旅費交通費**: `X:旅費交通費`
- **通信費**: `X:通信費`
- **外注工賃**: `X:外注費`
- **支払手数料**: `X:支払手数料`
- **租税公課**: `X:租税公課`
- **雑費**: `X:雑費`

#### 所得金額
- **差引金額** = 収入金額 - 経費
- **青色申告特別控除額**: 65万円（電子申告の場合）または55万円
- **所得金額** = 差引金額 - 青色申告特別控除額

### 貸借対照表（4ページ目）

#### 資産の部
- **現金**: `A:現金`
- **預金**: `A:銀行` の各口座
- **売掛金**: `A:売掛金`
- **前払費用**: `A:前払費用`
- **備品**: `A:備品`（減価償却累計額控除後）

#### 負債・資本の部
- **買掛金**: `L:買掛金`
- **未払金**: `L:未払金`
- **クレジットカード**: `L:クレジットカード`
- **借入金**: `L:借入金`
- **元入金**: `E:期首残高` + 前期繰越利益 + 事業主借 - 事業主貸

## レポート出力内容

### 1. 年次サマリー
- 対象年度
- 総取引件数
- 総売上高
- 総経費
- 事業所得（青色申告特別控除前）
- 青色申告特別控除後の所得

### 2. 損益計算書
- 収入の部（売上・雑収入）
- 経費の部（各科目別）
- 差引金額
- 所得金額

### 3. 貸借対照表
- 資産の部（流動資産・固定資産）
- 負債の部（流動負債・固定負債）
- 純資産の部（元入金・利益）

### 4. 各種明細
- 月別売上推移
- 月別経費推移
- 主要な取引先別売上（可能であれば）
- 減価償却資産の明細

### 5. チェックリスト
- □ すべての領収書・請求書の保管確認
- □ 家事按分の根拠記録確認
- □ 売掛金・買掛金の残高確認
- □ 棚卸資産の評価確認
- □ 減価償却の計算確認
- □ 前払費用・未払費用の計上確認
- □ memo による判断根拠の記録確認
- □ 銀行口座との残高照合

## 期末処理のサポート

### 減価償却費の計上
```
YYYY/12/31 * 減価償却費の計上
    X:減価償却費             50000 JPY
    A:備品:減価償却累計額
```

### 前払費用の計上
```
YYYY/12/31 * 翌年分の前払費用計上
    A:前払費用               10000 JPY
    X:通信費
```

### 未払費用の計上
```
YYYY/12/31 * 未払費用の計上
    X:水道光熱費             5000 JPY
    L:未払金
```

### 期末残高の繰越
```
YYYY/12/31 * 当期利益の繰越
    R:売上
    X:各種経費
    E:繰越利益
```

## エクスポートファイルの活用

生成されたCSVファイルは以下の用途に使用できます：
- 確定申告ソフト（e-Tax、freee、MFクラウドなど）へのインポート
- Excel/Googleスプレッドシートでの詳細分析
- 税理士への提出資料

## 実行例

```bash
# 年次集計の実行
./lgr validate         # 全体検証
./lgr check           # 貸借一致確認
./lgr yearly          # 年次集計
./lgr export          # CSVエクスポート
```

## 申告期限の注意

- **確定申告期限**: 翌年3月15日
- **青色申告の承認申請**: 開業後2ヶ月以内（または1月1日から3月15日）
- **帳簿の保存期間**: 7年間（青色申告の場合）

年次集計は年末または翌年1月に実行し、早めに申告準備を進めることを推奨します。
