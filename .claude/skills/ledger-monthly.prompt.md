# 月次チェック・集計アシスタント

指定された月の帳簿を検証し、月次集計レポートを生成します。記帳漏れや不整合がないか確認し、財務状況を可視化します。

## 実行手順

1. **対象月の確認**
   - ユーザーから対象月を確認（例：2026-01）
   - 指定がない場合は当月を対象とする

2. **ファイルの存在確認**
   - 該当月のファイル（例：`ledger/2026/01.ledger`）が存在するか確認
   - 存在しない場合はユーザーに通知し、処理を中断

3. **勘定科目の検証**
   ```bash
   ./lgr validate
   ```
   - すべての勘定科目が `ledger/accounts.ledger` で定義されているか確認
   - 未定義の勘定科目があればエラーを報告し、修正を提案

4. **貸借一致チェック**
   ```bash
   ./lgr check
   ```
   - すべての仕訳で借方・貸方が一致しているか確認
   - 不一致があればエラーを報告し、該当の仕訳を特定

5. **月次集計の生成**
   ```bash
   ./lgr monthly YYYY-MM
   ```
   - 指定月の集計レポートを生成
   - 出力内容を分かりやすく整形して表示

6. **レポートの分析と提示**
   - 主要な勘定科目の増減を分析
   - 注意すべき点や確認が必要な項目を指摘
   - 前月比較（可能であれば）

7. **改善提案**
   - 記帳の改善点があれば提案
   - memo の記録が不足している可能性を指摘
   - 次月に向けたアドバイス

## チェックポイント

### 必須チェック項目
- ✓ 勘定科目の定義確認（validate）
- ✓ 貸借一致確認（check）
- ✓ 月次集計の生成（monthly）

### 推奨チェック項目
- 大きな金額の取引に memo が記録されているか
- 家事按分が必要な経費に按分記録があるか
- 売掛金・買掛金の残高確認
- 前払費用・未払費用の計上漏れがないか

## レポート出力形式

月次レポートには以下の情報を含める：

1. **基本情報**
   - 対象年月
   - 取引件数
   - 検証結果（Pass/Fail）

2. **主要勘定科目の残高**
   - 資産（現金、銀行預金）
   - 負債（クレジットカード、買掛金）
   - 当月の売上合計
   - 当月の経費合計

3. **経費の内訳**
   - 各経費科目の金額
   - 前月比（可能であれば）

4. **注意事項・確認事項**
   - エラーや警告
   - 記録が推奨される事項
   - 次月への申し送り事項

## エラー時の対応

- **勘定科目エラー**: 未定義の勘定科目を特定し、`ledger/accounts.ledger` への追加を支援
- **貸借不一致エラー**: 該当の仕訳を特定し、修正方法を提案
- **ファイル不存在**: 年度・月次ファイルの作成を提案（`./lgr init-year` の利用）

## 実行例

```bash
# 2026年1月の月次チェック
./lgr validate          # 勘定科目検証
./lgr check            # 貸借一致チェック
./lgr monthly 2026-01  # 月次集計
```

月次チェックは月末または翌月初めに実行することを推奨します。
