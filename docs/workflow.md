# 日常的な記帳ワークフロー

このドキュメントでは、日々の帳簿記入から月次・年次の処理まで、実際の運用フローを説明します。

## 基本的な記帳サイクル

```
日次/週次: 取引の記録
    ↓
週次/月次: 貸借チェック
    ↓
月次: 月次集計の確認
    ↓
年次: 決算処理 → 確定申告
```

## 1. 日常的な取引の記録

### 年次ディレクトリの作成

年度が変わったら、まず年次ディレクトリと12ヶ月分のファイルを一括作成します。

```bash
# 現在の年度のディレクトリを作成
./lgr init-year

# 特定の年度を指定
./lgr init-year 2027
```

> [!NOTE]
> Windows PowerShell/Command Prompt では `./` を省略して `lgr` と実行してください。

このコマンドで以下が自動的に作成されます：

- `ledger/YYYY/` ディレクトリ
- `01.ledger` から `12.ledger` までの12個のファイル（テンプレート適用済み）
- 既存のファイルは上書きされません（安全）

### 取引の記帳

取引が発生したら、月次ファイルに記録します。

**例1：現金で経費を支払った場合**

```ledger
2026/01/05 * 事務用品購入
    X:消耗品費           3000 JPY
    A:現金
```

**例2：売上が銀行口座に入金された場合**

```ledger
2026/01/10 * クライアントA 請求書#001
    A:銀行:事業用       100000 JPY
    R:売上
```

**例3：クレジットカードで経費を支払った場合**

```ledger
2026/01/15 * サーバー代（AWS）
    X:通信費      5000 JPY
    L:クレジットカード

; 後日、クレジットカードの引き落とし
2026/02/01 * クレジットカード引き落とし
    L:クレジットカード      5000 JPY
    A:銀行:事業用
```

**例4：按分が必要な経費（家賃など）**

```ledger
2026/01/25 * 家賃（事業利用30%）
    X:地代家賃              30000 JPY  ; 事業按分30%
    E:事業主貸              70000 JPY  ; 個人利用分
    A:銀行:事業用
```

### 記帳のポイント

- **日付順に記録**：取引日順に並べると後で見やすい
- **説明を明確に**：取引相手や内容を具体的に書く
- **レシート番号**：`; receipt: 2026-01-15-invoice-001.pdf` のようにコメントで記録
- **こまめに記帳**：週1回程度は最低でも記帳する習慣を

### 領収書メモの運用

プロジェクトの設計思想として、**帳簿（ledger）と判断根拠（memo）を分離**しています。

- **ledgerファイル** = 客観的な会計事実（What happened）
- **memoファイル** = 判断の理由と背景（Why we recorded it this way）

領収書やレシートごとに `templates/receipt.memo.tpl` を使ってメモを作成します。

**ファイル名の例：**
```
memo/2026/01/receipt-001.md  # 2026年1月の1件目
memo/2026/01/receipt-002.md  # 2026年1月の2件目
```

**記録すべき内容：**
- 基本情報（日付、支払先、金額、勘定科目）
- **按分の根拠**：「自宅兼事務所、総面積100㎡のうち事務所専用スペース50㎡のため50%按分」
- **業務上の必要性**：「クライアント向けWebサイト開発に使用するため」
- **税務上の判断理由**：「国税庁タックスアンサーNo.1805参照」

これにより、税務調査や将来の自分に対して、なぜその記帳をしたかを説明できます。

## 2. 検証とチェック

### 貸借が一致しているか確認

```bash
# 貸借チェック
docker compose run --rm ledger npm run check
```

エラーが出た場合は、記帳ミスがある可能性があります。

### 残高の確認

```bash
# すべての勘定科目の残高を表示
docker compose run --rm ledger ledger \
  -f ledger/accounts.ledger \
  -f ledger/opening_balance.ledger \
  -f ledger/2026/01.ledger \
  balance

# 現金の残高のみ表示
docker compose run --rm ledger ledger \
  -f ledger/accounts.ledger \
  -f ledger/opening_balance.ledger \
  -f ledger/2026/01.ledger \
  balance A:現金
```

実際の現金残高や銀行残高と照合してください。

## 3. 変更の保存（Git）

記帳が終わったら、変更をGitで保存します。

```bash
# 変更を確認
git status
git diff

# 変更をステージング
git add ledger/2026/01.ledger

# または年別ディレクトリごと
# git add ledger/2026/

# コミット（わかりやすいメッセージを書く）
git commit -m "2026-01: 1/5-1/10の取引を記帳"

# リモートにプッシュ（バックアップ）
git push
```

### コミットメッセージの例

- `"2026-01: 1月前半の取引を記帳"`
- `"2026-01: AWS請求書を追加"`
- `"accounts: 書籍費の勘定科目を追加"`

## 4. 月次処理

### 月次集計の確認

```bash
# 1月の集計を表示
docker compose run --rm ledger node scripts/monthly-summary.mjs --month 2026-01
```

### 月末のチェックリスト

- [ ] すべての取引を記帳済み
- [ ] 銀行口座の残高を照合
- [ ] クレジットカードの明細と照合
- [ ] 売掛金・買掛金の確認
- [ ] 貸借チェックがパス
- [ ] Gitにコミット＆プッシュ

## 5. 年次処理

### 年次集計

```bash
# 年間の集計を表示
docker compose run --rm ledger node scripts/yearly-summary.mjs
```

### 決算処理（12月31日または期末）

1. **損益の確定**

すべての収益・費用を集計し、利益を計算します。

```ledger
; 決算整理仕訳（closing.ledger に記載）

2026/12/31 * 決算整理：損益の確定
    R:売上               -1200000 JPY  ; 売上の相殺
    X:消耗品費            150000 JPY  ; 経費の相殺
    X:通信費        60000 JPY
    X:地代家賃                360000 JPY
    ; ... 他の経費も同様に
    E:繰越利益              JPY  ; 差額が利益
```

2. **翌年度の期首残高**

#### 継続年度の場合（前年度から事業継続）

翌年の opening.ledger に、すべての資産・負債・純資産の残高を記録します。

```ledger
; ledger/2027/opening.ledger

2027/01/01 * 期首残高（資産）
    A:現金                     47000 JPY
    A:銀行:事業用           680000 JPY
    A:備品               100000 JPY
    E:期首残高

2027/01/01 * 期首残高（負債）
    E:期首残高              -50000 JPY
    L:クレジットカード

2027/01/01 * 前年度繰越利益
    E:期首残高             630000 JPY  ; 前年の利益
    E:繰越利益
```

**注意：** 前年度の closing.ledger と金額を一致させ、期首残高の合計は必ずゼロになるようにします。

#### 開業初年度の場合

開業時は初期資本金を設定します。

```ledger
; ledger/2026/opening.ledger（2026年開業の場合）

2026/01/01 * 開業資本金
    A:現金                 100000 JPY
    A:銀行:事業用         500000 JPY
    E:期首残高
```

事業用として確保した現金・銀行預金を資産として計上し、同額を期首残高（純資産）に記録します。

詳しくは [tax-filing.md](tax-filing.md) を参照してください。

## よくある作業パターン

### 売掛金の処理

```ledger
; 請求書を発行した時点
2026/01/20 * クライアントB 請求書#002
    A:売掛金   80000 JPY
    R:売上

; 入金された時点
2026/02/05 * クライアントB 入金
    A:銀行:事業用        80000 JPY
    A:売掛金
```

### 前払費用の処理

```ledger
; 年払いのサーバー代を支払った
2026/01/01 * サーバー年間契約
    A:前払費用      60000 JPY
    A:銀行:事業用

; 毎月、費用として計上
2026/01/31 * サーバー代（1月分）
    X:通信費       5000 JPY
    A:前払費用
```

### 固定資産の減価償却

```ledger
; 備品を購入（10万円以上）
2026/04/01 * ノートPC購入
    A:備品           150000 JPY
    A:銀行:事業用

; 年末に減価償却（定額法、耐用年数4年の場合）
2026/12/31 * 減価償却（PC 9ヶ月分）
    X:減価償却費       28125 JPY  ; 150000 / 4年 * 9/12
    A:備品
```

### 在庫の計上（商品販売業の場合）

商品を仕入れて販売する業種では、期末に在庫を棚卸して資産として計上します。

**仕入時：**
```ledger
2026/06/15 * 商品仕入
    X:CostOfGoodsSold      200000 JPY
    A:銀行:事業用
```

**期末棚卸（12/31）：**
```ledger
; 期末在庫を資産に振替
2026/12/31 * 期末棚卸
    A:Inventory            80000 JPY  ; 在庫残高
    X:CostOfGoodsSold
```

**注意：** サービス業など在庫を持たない業種では、この処理は不要です。

### 事業主貸・事業主借の処理

個人事業主特有の勘定科目です。事業と個人の資金のやり取りを記録します。

**事業主貸（事業→個人）：**
```ledger
; 生活費を事業口座から引き出し
2026/03/01 * 生活費
    E:事業主貸            100000 JPY
    A:銀行:事業用

; 個人用クレジットカードで払った事業経費（後で個人に返済）
2026/03/15 * 飲食（接待）※個人カード立替
    X:会議費交際費          5000 JPY
    E:事業主貸  ; 個人への返済義務
```

**事業主借（個人→事業）：**
```ledger
; 個人資金を事業に追加
2026/04/01 * 個人資金の投入
    A:銀行:事業用          200000 JPY
    E:事業主借

; 個人カードで購入した事業用品（個人が立て替え）
2026/04/10 * PC購入（個人カード支払い）
    X:消耗品費              80000 JPY
    E:事業主借  ; 個人から借りた形
```

### 支払手数料の処理

```ledger
; 銀行振込手数料
2026/05/10 * クライアントA への振込手数料
    X:支払手数料               440 JPY
    A:銀行:事業用

; 決済サービス手数料
2026/05/15 * Stripe 決済手数料
    X:支払手数料              1500 JPY
    A:銀行:事業用
```

### 新聞図書費の処理

```ledger
; 業務関連の書籍購入
2026/06/01 * プログラミング技術書
    X:新聞図書費             3800 JPY
    A:銀行:事業用

; 業界雑誌の年間購読
2026/06/10 * 日経ビジネス年間購読
    X:新聞図書費            24000 JPY
    L:クレジットカード
```

### 雑費の処理

```ledger
; 分類が難しい少額経費
2026/07/15 * コワーキングスペース ドロップイン
    X:雑費                   1500 JPY
    A:現金

; 事業用印鑑購入
2026/07/20 * 角印・銀行印作成
    X:雑費                   4800 JPY
    A:銀行:事業用
```

### 未払金の処理

```ledger
; 請求書を受け取った時点（クレジットカード以外）
2026/08/15 * ウェブ制作外注費
    X:外注費               150000 JPY
    L:未払金

; 支払った時点
2026/08/31 * 外注費の支払い
    L:未払金               150000 JPY
    A:銀行:事業用
```

## トラブルシューティング

### 残高が合わない

1. 銀行の明細を最初から照合
2. 未記帳の取引がないか確認
3. 勘定科目の間違いがないか確認
4. 金額の桁を間違えていないか確認

### 勘定科目エラー

```bash
# 使用されている勘定科目をチェック
docker compose run --rm ledger node scripts/validate-accounts.mjs
```

エラーが出た勘定科目を `ledger/accounts.ledger` に追加します。

## まとめ

1. **こまめに記帳**：週1回は記帳する習慣をつける
2. **照合を欠かさない**：銀行口座、現金の残高を定期的に照合
3. **Gitで履歴管理**：記帳したらコミット＆プッシュ
4. **月次・年次で確認**：集計スクリプトで数字を確認

次のステップ：

- [tax-filing.md](tax-filing.md) - 確定申告の準備
- [accounts.md](accounts.md) - 勘定科目の詳細
